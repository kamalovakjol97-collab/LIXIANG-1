# Перенос базы данных на Spaceweb (xgl-group.ru)

Пошаговая инструкция: создать базу MySQL на Spaceweb, залить таблицу заявок, настроить PHP-скрипт и загрузить всё так, чтобы форма на сайте работала.

---

## Шаг 1. Создать базу данных в панели Spaceweb

1. Войдите в **панель управления** хостингом Spaceweb (например, [sweb.ru](https://sweb.ru) → «Войти»).
2. Найдите раздел **«Базы данных»** или **«MySQL»** (название может быть «Облачная БД», «MySQL 8.0» и т.п.).
3. Нажмите **«Создать базу данных»** (или аналогичную кнопку).
4. Укажите:
   - **Имя базы** — например `xgl_site` или `u12345_xgl` (часто к имени добавляется префикс аккаунта).
   - **Пользователь** — логин для доступа к этой БД (запомните его).
   - **Пароль** — придумайте надёжный пароль и **сохраните его** (он понадобится в шаге 4).
5. Подтвердите создание. Дождитесь, пока статус БД станет «Активна» или «Работает».

**Важно:** запишите или сохраните в надёжном месте:
- имя базы данных (например, `u12345_xgl`);
- имя пользователя;
- пароль;
- хост подключения (часто **`localhost`**; если в панели указан другой — используйте его).

Подробнее: [Как создать базу данных на Spaceweb](https://help.sweb.ru/kak-sozdat6-bazu-dannyh_963.html).

---

## Шаг 2. Создать таблицу заявок (phpMyAdmin)

1. В панели Spaceweb откройте **phpMyAdmin** (ссылка обычно в разделе «Базы данных» или «MySQL»). Либо перейдите по адресу, который указан в инструкции хостинга.
2. Войдите в phpMyAdmin под тем же пользователем БД (или под учётной записью хостинга, если она привязана к БД).
3. Слева выберите **вашу базу данных** (ту, что создали в шаге 1).
4. Перейдите на вкладку **«SQL»**.
5. Откройте в проекте файл **`spaceweb-applications.sql`** и **скопируйте весь его текст**.
6. Вставьте скопированный SQL в поле запроса в phpMyAdmin и нажмите **«Вперёд»** (или **«Выполнить»**).
7. Должно появиться сообщение об успешном выполнении. Таблица **`applications`** создана.

Проверка: слева в списке таблиц должна появиться таблица **`applications`**. Откройте её и убедитесь, что есть столбцы: `id`, `cargo_type`, `from_location`, `to_location`, `phone`, `company_name`, `created_at`.

---

## Шаг 3. Подготовить конфиг для PHP на своём компьютере

1. В папке проекта откройте папку **`api`**.
2. В ней есть файл **`db_config.example.php`**. **Скопируйте** его и переименуйте копию в **`db_config.php`** (в той же папке `api`).
3. Откройте **`db_config.php`** в редакторе и подставьте **реальные** данные из шага 1:

```php
return [
    'host'     => 'localhost',        // Хост из панели (часто localhost)
    'dbname'   => 'u12345_xgl',      // Имя вашей базы
    'username' => 'u12345_xgl',      // Пользователь БД
    'password' => 'ваш_пароль',       // Пароль от БД
    'charset'  => 'utf8mb4',
];
```

4. Сохраните файл. **Не загружайте `db_config.php` в Git** — он уже добавлен в `.gitignore`, так как содержит пароль.

---

## Шаг 4. Загрузить PHP-файлы на хостинг по FTP

1. Подключитесь к хостингу по **FTP** (FileZilla, WinSCP или файловый менеджер в панели Spaceweb). Логин и пароль — от FTP-доступа к сайту (часто те же, что и для входа в панель).
2. Откройте каталог, откуда открывается сайт **http://xgl-group.ru/** — обычно это **`public_html`** или **`www`** (в нём уже лежат `index.html`, папки `assets`, `images` и т.д.).
3. Загрузите **в этот же корень** (рядом с `index.html`) два файла:
   - **`application.php`** — из папки **`api`** вашего проекта (файл `api/application.php`).
   - **`db_config.php`** — тот, что вы создали и заполнили в шаге 3 (из папки `api` на вашем компьютере).

В итоге в корне сайта должны быть, например:

```
public_html/
  index.html
  .htaccess
  application.php    ← скрипт приёма заявок
  db_config.php      ← настройки БД (не публикуйте в открытый репозиторий)
  assets/
  images/
  ...
```

**Важно:** путь к `db_config.php` в скрипте указан как «рядом с application.php» (`__DIR__ . '/db_config.php'`). Поэтому оба файла должны лежать в одном каталоге (корне сайта).

---

## Шаг 5. Пересобрать сайт и залить обновлённый фронт

Форма на сайте уже настроена на отправку данных на **`/application.php`** (то есть на http://xgl-group.ru/application.php). Нужно только убедиться, что на хостинге лежит **актуальная** сборка с этой логикой.

1. На своём компьютере в **корне проекта** откройте терминал.
2. Выполните сборку:
   ```bash
   npm run build
   ```
3. По FTP загрузите **содержимое** папки **`dist`** в тот же каталог, где лежит `application.php` (как при первом деплое):
   - обновлённый `index.html`;
   - папка `assets` (можно перезаписать целиком);
   - при необходимости обновлённые файлы в `images` и т.д.
4. Файлы **`application.php`** и **`db_config.php`** при этом **не трогайте** — они уже загружены в шаге 4.

После этого сайт будет отдавать новую версию с формой, которая шлёт заявки на ваш PHP.

---

## Шаг 6. Проверить, что всё работает

1. Откройте сайт **http://xgl-group.ru/**.
2. Перейдите к форме заявки (кнопка «Рассчитать стоимость» или блок с формой внизу главной).
3. Заполните все обязательные поля и нажмите **«Отправить запрос»**.
4. Должно появиться сообщение **«Заявка отправлена!»** (или аналог на выбранном языке).
5. Проверьте базу:
   - зайдите в **phpMyAdmin** → ваша база → таблица **`applications`**;
   - во вкладке «Обзор» или «Просмотр» должна появиться новая строка с только что отправленными данными.

Если вместо успеха видите ошибку или пустую страницу — см. раздел «Частые проблемы» ниже.

---

## Частые проблемы

**Форма не отправляется / «Заявка не отправлена»**

- Убедитесь, что в корне сайта (рядом с `index.html`) лежат **`application.php`** и **`db_config.php`**.
- Проверьте в `db_config.php` хост, имя БД, логин и пароль (без лишних пробелов, кавычки закрыты).
- Откройте в браузере: **http://xgl-group.ru/application.php** — при отправке POST скрипт не должен показывать пустую страницу; при ошибке PHP может вывести текст ошибки (по нему можно понять причину).

**Ошибка «Server config missing»**

- На хостинг не загружен файл **`db_config.php`** или он лежит в другой папке, не рядом с `application.php`. Загрузите `db_config.php` в тот же каталог, что и `application.php`.

**Ошибка «Database error»**

- Неверные данные в `db_config.php` (хост, имя БД, пользователь, пароль).
- Таблица `applications` не создана — выполните шаг 2 (SQL из `spaceweb-applications.sql`).
- В панели Spaceweb проверьте, что БД и пользователь активны и привязаны друг к другу.

**После обновления сайта форма снова не работает**

- Убедитесь, что залили актуальное содержимое **`dist`** (после `npm run build`) и не перезаписали или не удалили **`application.php`** и **`db_config.php`**.

---

## Краткая сводка файлов

| Файл | Где лежит в проекте | Куда загружать на Spaceweb |
|------|---------------------|----------------------------|
| `application.php` | `api/application.php` | В корень сайта (рядом с `index.html`) |
| `db_config.php` | создаёте из `api/db_config.example.php` | В корень сайта (рядом с `application.php`) |
| `spaceweb-applications.sql` | корень проекта | Не загружать; выполнить в phpMyAdmin (шаг 2) |
| Содержимое `dist/` | после `npm run build` | В корень сайта (как при деплое) |

После выполнения всех шагов база данных будет на Spaceweb, заявки с http://xgl-group.ru/ будут сохраняться в таблицу **`applications`** в вашей MySQL. Просматривать и выгружать заявки можно через phpMyAdmin в панели Spaceweb.
